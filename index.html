<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>HackBall</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: white;
      text-align: center;
    }
    #lobby {
      padding-top: 50px;
    }
    #game {
      display: none;
      margin: 20px auto;
      background: #222;
      border: 2px solid #fff;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="lobby">
  <h1>⚽ HackBall'a Hoş Geldin</h1>
  <input type="text" id="nickname" placeholder="Takma adını yaz"><br>
  <input type="text" id="roomId" placeholder="Parti ID gir (örnek: abc123)"><br>
  <button onclick="joinGame()">Katıl</button>
  <button onclick="createRoom()">Yeni Parti Oluştur</button>
</div>

<canvas id="game" width="600" height="400"></canvas>

<script>
  let nickname = '';
  let roomId = '';
  let ws;
  let players = {};
  let ball = { x: 300, y: 200 };

  function createRoom() {
    const nameInput = document.getElementById('nickname');
    nickname = nameInput.value.trim();
    if (!nickname) return alert("Lütfen takma ad gir");

    roomId = Math.random().toString(36).substring(2, 8); // rastgele ID
    connectWebSocket();
  }

  function joinGame() {
    const nameInput = document.getElementById('nickname');
    const roomInput = document.getElementById('roomId');
    nickname = nameInput.value.trim();
    roomId = roomInput.value.trim();
    if (!nickname || !roomId) return alert("Lütfen hem takma ad hem parti ID gir");

    connectWebSocket();
  }

  function connectWebSocket() {
    // Örnek WebSocket URL'si — kendi server URL'inle değiştir
    ws = new WebSocket('wss://YOUR_SERVER_URL');

    ws.onopen = () => {
      ws.send(JSON.stringify({ type: 'join', nickname, roomId }));
      document.getElementById('lobby').style.display = 'none';
      document.getElementById('game').style.display = 'block';
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'gameState') {
        players = data.players;
        ball = data.ball;
      }
    };

    window.addEventListener('keydown', e => {
      if (!ws || ws.readyState !== WebSocket.OPEN) return;
      let dir = null;
      if (e.key === 'ArrowLeft') dir = 'left';
      else if (e.key === 'ArrowRight') dir = 'right';
      else if (e.key === 'ArrowUp') dir = 'up';
      else if (e.key === 'ArrowDown') dir = 'down';

      if (dir) {
        ws.send(JSON.stringify({ type: 'move', dir }));
      }
    });

    draw();
  }

  function draw() {
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = 'red';
    for (let id in players) {
      let p = players[id];
      ctx.beginPath();
      ctx.arc(p.x, p.y, 15, 0, Math.PI * 2);
      ctx.fill();

      // Takma adını yaz
      ctx.fillStyle = 'white';
      ctx.fillText(p.nickname || '', p.x - 20, p.y - 20);
      ctx.fillStyle = 'red';
    }

    requestAnimationFrame(draw);
  }
</script>

</body>
</html>
