<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HackBall</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 16px;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <div id="scoreboard">ðŸ”µ 0 - 0 ðŸ”´</div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://hackball-server.onrender.com"); // WAN sunucun

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const keys = {};
    const speed = 4;
    let myId = null;
    let players = {};
    let ball = { x: 400, y: 300 };
    let scores = { red: 0, blue: 0 };

    // TuÅŸ kontrolleri
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    // BaÅŸlangÄ±Ã§ verileri
    socket.on("init", data => {
      myId = data.id;
      players = data.players;
      ball = data.ball;
      scores = data.scores;
    });

    // Yeni oyuncu eklendi
    socket.on("playerJoined", ({ id, data }) => {
      players[id] = data;
    });

    // Oyuncu ayrÄ±ldÄ±
    socket.on("playerLeft", id => {
      delete players[id];
    });

    // Sunucudan gelen anlÄ±k durum
    socket.on("state", data => {
      players = data.players;
      ball = data.ball;
      scores = data.scores;
      updateScoreboard();
    });

    function updateScoreboard() {
      const scoreText = `ðŸ”µ ${scores.blue} - ${scores.red} ðŸ”´`;
      document.getElementById("scoreboard").innerText = scoreText;
    }

    function gameLoop() {
      // EkranÄ± temizle
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Kale Ã§iz
      ctx.fillStyle = "blue";
      ctx.fillRect(0, 200, 40, 200);
      ctx.fillStyle = "red";
      ctx.fillRect(760, 200, 40, 200);

      // Oyuncu hareketi
      if (myId && players[myId]) {
        const me = players[myId];
        if (keys["arrowup"] || keys["w"]) me.y -= speed;
        if (keys["arrowdown"] || keys["s"]) me.y += speed;
        if (keys["arrowleft"] || keys["a"]) me.x -= speed;
        if (keys["arrowright"] || keys["d"]) me.x += speed;

        socket.emit("move", { x: me.x, y: me.y });
      }

      // TÃ¼m oyuncularÄ± Ã§iz
      for (let id in players) {
        const p = players[id];
        ctx.beginPath();
        ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.stroke();
      }

      // Topu Ã§iz
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, 10, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.fill();

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
